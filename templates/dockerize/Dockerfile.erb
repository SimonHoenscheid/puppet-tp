# Dockerfile generated by tp::dockerize { '<%= @app %>': }
FROM <%= @real_from %>
<% if @maintainer -%>
MAINTAINER <%= @maintainer %>
<% end -%>
<% if @os == 'debian' or @os == 'ubuntu' -%>
<% if @settings['repo_url'] -%>
RUN echo "deb <%= @settings['repo_url'] -%> <%= @settings['apt_repos'] %> <%= @settings['apt_release'] %>" > /etc/apt/sources.list.d/<%= @app %>.list 
<% if @settings['apt_key_server'] -%>
RUN apt-key add --keyserver <%= @settings['apt_key_server'] %> --recv-key <%= @settings['key'] %>
<% end -%>
<% end -%>
RUN apt-get update && \
    apt-get install -y --no-install-recommends <%= @settings['package_name'] %> && \
    rm -rf /var/lib/apt/lists/*
<% end -%>
<% if @os == 'redhat' or @os == 'centos' -%>
<% if @settings['repo_url'] -%>
RUN echo "[<%= @app %>]\nname=<%= @app %> repository\nbaseurl=<%= @settings['repo_url'] -%> > /etc/yum.repos.d/<%= @app %>.repo
<% end -%>
RUN yum install -y epel-release
RUN yum install -y <%= @settings['package_name'] %> && yum clean all
<% end -%>
<% if @settings['tcp_port'] -%>
EXPOSE <%= @settings['tcp_port'] %>
<% end -%>
<% if @settings['data_dir_path'] and @mount_data_dir -%>
VOLUME <%= @settings['data_dir_path'] %>
<% end -%>
<% if @settings['log_dir_path'] and @mount_log_dir -%>
VOLUME <%= @settings['log_dir_path'] %>
<% end -%>
ENTRYPOINT [ "<%= @settings['process_name'] %>"<% if @settings['process_extra_name'] -%> , "<%= @settings['process_extra_name'] -%>"<% end -%> ]
<% if @settings['process_args'] -%>
CMD [ <% comma = '' %><% @settings['process_args'].split.each do |ar| %><%= comma %>"<%= ar %>"<% comma = ',' %><% end -%> ]
<% end -%>
